<script>
  console.log("[price-monitor.html] Top-level script running");
</script>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Warframe Market Price Monitor</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- All layout + navbar + background styles -->
    <link rel="stylesheet" href="../design/background.css" />
    <link rel="stylesheet" href="../design/price-monitor.css" />
  </head>
  <body>
    <!-- Top navbar similar to warframe.market -->
    <header class="wm-navbar">
      <div class="wm-navbar-left">
        <button class="hamburger-menu" id="hamburger-menu">☰</button>
        <div class="wm-logo">
          <span class="wm-logo-main">WARFRAME</span>
          <span class="wm-logo-sub">Price Monitor</span>
        </div>

        <div class="wm-platform-select">
          <button class="wm-platform-btn">
            <span>PC</span>
            <span class="wm-platform-chevron">▾</span>
          </button>
          <ul class="wm-platform-dropdown">
            <li>PC</li>
            <li>PSN</li>
            <li>XBOX</li>
            <li>SWITCH</li>
          </ul>
        </div>
      </div>

      <div class="wm-navbar-right">
        <nav class="wm-nav-links">
          <a href="#" class="active">Market</a>
          <a href="#">Contracts</a>
          <a href="#">Tools</a>
        </nav>

        <button class="wm-signin-btn">Sign In</button>

        <!-- Burger to open side menu -->
        <button class="wm-menu-toggle" aria-label="Toggle menu">☰</button>
      </div>
    </header>

    <!-- Left slide-out menu -->
    <aside class="side-panel" id="side-panel">
      <div class="side-panel-header">
        <span>Menu</span>
        <button class="side-close" id="side-close">✕</button>
      </div>
      <nav class="side-panel-links">
        <a href="#" class="active">Live Market</a>
        <a href="#">Price History</a>
        <a href="settings.html">Settings</a>
        <a href="about.html">About</a>
      </nav>
    </aside>

    <!-- Right slide-out menu -->
    <aside class="wm-side-menu" id="wm-side-menu">
      <div class="wm-side-menu-header">
        <span>Menu</span>
        <button
          class="wm-side-close"
          id="wm-side-close"
          aria-label="Close menu"
        >
          ✕
        </button>
      </div>
      <nav class="wm-side-links">
        <a href="#" class="active">Market</a>
        <a href="#">Contracts</a>
        <a href="#">Tools</a>
        <hr />
        <a href="#">Profile</a>
        <a href="settings.html">Settings</a>
        <a href="#">Help</a>
      </nav>
    </aside>

    <div class="container">
      <h1>Warframe Market Price Monitor</h1>

      <form id="item-form">
        <label for="item-name">Item Name</label>
        <input
          type="text"
          id="item-name"
          placeholder="e.g. rubico_prime_set"
          autocomplete="off"
          required
        />

        <div class="form-row">
          <div class="form-group">
            <label for="min-price">Min Unit Price</label>
            <input
              type="number"
              id="min-price"
              placeholder="Min price"
              min="0"
              step="0.01"
            />
          </div>
          <div class="form-group">
            <label for="max-price">Max Unit Price</label>
            <input
              type="number"
              id="max-price"
              placeholder="Max price"
              min="0"
              step="0.01"
            />
          </div>
        </div>

        <button type="submit">Monitor</button>
      </form>

      <!-- NEW: Item list / autocomplete container -->
      <div id="item-list"></div>
    </div>

    <!-- Item section to be displayed plus the sub-items if there are any -->
    <div id="item-display"></div>

    <!-- Orders section: separator and grid together, moved down -->
    <div id="orders-section-wrapper">
      <!-- Section separator like warframe.market -->
      <div class="orders-separator">
        <h2>MOST RECENT ORDERS <span class="caret">▼</span></h2>
      </div>
      <!-- Two-column orders layout -->
      <section class="orders-section">
        <div class="orders-grid">
          <div id="orders-sell"></div>
          <div id="orders-buy"></div>
        </div>
      </section>
    </div>

    <!-- Modularized: shared UI logic for menus and platform dropdown -->
    <script src="utils/ui-common.js"></script>
    <script src="utils/notifications.js"></script>
    <script src="utils/items.js"></script>
    <!-- Dynamic order rendering: loops through data and generates order cards -->
    <script src="utils/orders-dynamic.js"></script>

    <script>
      // Load default min/max prices from settings
      document.addEventListener('DOMContentLoaded', () => {
        // Function to get current settings (same as in settings.js)
        function getSettings() {
          const saved = localStorage.getItem('warframe-monitor-settings');
          const defaultSettings = {
            refreshInterval: 30,
            enableNotifications: true,
            enableSounds: false,
            defaultPlatform: 'pc',
            ordersPerColumn: 10,
            theme: 'dark',
            hideOffline: true,
            verifiedOnly: false,
            defaultMinPrice: '',
            defaultMaxPrice: '',
            minimizeToTray: true,
            startMinimized: false
          };
          return saved ? { ...defaultSettings, ...JSON.parse(saved) } : defaultSettings;
        }

        // Load settings and populate min/max price inputs
        const settings = getSettings();
        const minPriceInput = document.getElementById('min-price');
        const maxPriceInput = document.getElementById('max-price');
        
        if (minPriceInput && settings.defaultMinPrice) {
          minPriceInput.value = settings.defaultMinPrice;
        }
        
        if (maxPriceInput && settings.defaultMaxPrice) {
          maxPriceInput.value = settings.defaultMaxPrice;
        }
      });

      // Call the displayItemAndSubItems function from items.js
      window.displayItemAndSubItems("item-form", "item-name", "item-display");
    </script>

    <!-- Footer container - dynamically loaded -->
    <div id="footer-container"></div>

    <!-- Footer loader -->
    <script src="utils/footer.js"></script>
  </body>
</html>
